<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>CV Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');
  </style>
</head>
<body class="bg-gray-50 p-8">
  <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-10">

    <!-- HEADER -->
    <header class="text-center border-b-2 border-blue-600 pb-4 mb-6">
      <h1 class="text-4xl font-bold text-gray-800 mb-3">{{ cv.personal_info.name or "Your Name" }}</h1>

      <div class="flex flex-wrap justify-center items-center gap-3 text-sm text-gray-600">
        {% if cv.personal_info.github %}
        <a href="{{ cv.personal_info.github }}" target="_blank" class="hover:text-blue-600">
          <i class="fab fa-github"></i> {{ cv.personal_info.github.split('/')[-1] }}
        </a>
        <span>|</span>
        {% endif %}

        {% if cv.personal_info.linkedin %}
        <a href="{{ cv.personal_info.linkedin }}" target="_blank" class="hover:text-blue-600">
          <i class="fab fa-linkedin"></i> {{ cv.personal_info.linkedin.split('/')[-1] }}
        </a>
        <span>|</span>
        {% endif %}

        {% if cv.personal_info.email %}
        <a href="mailto:{{ cv.personal_info.email }}" class="hover:text-blue-600">
          <i class="fas fa-envelope"></i> {{ cv.personal_info.email }}
        </a>
        <span>|</span>
        {% endif %}

        {% if cv.personal_info.phone %}
        <span><i class="fas fa-mobile-alt"></i> {{ cv.personal_info.phone }}</span>
        {% endif %}
      </div>

      {% if cv.personal_info.portfolio %}
      <div class="mt-2">
        <a href="{{ cv.personal_info.portfolio }}" target="_blank" class="text-sm text-blue-600 hover:underline">
          <i class="fas fa-globe"></i> Portfolio
        </a>
      </div>
      {% endif %}
    </header>

    <!-- SUMMARY -->
    <section class="mb-6">
      <h2 class="text-2xl font-bold text-blue-600 uppercase tracking-wide border-b-2 border-blue-600 pb-2 mb-3">Summary</h2>
      <p class="text-gray-700 leading-relaxed whitespace-pre-line">{{ cv.summary or "A motivated professional ready to contribute skills and grow in a dynamic environment." }}</p>
    </section>

    <!-- EXPERIENCE -->
    {% if cv.experience %}
    <section class="mb-6">
      <h2 class="text-2xl font-bold text-blue-600 uppercase tracking-wide border-b-2 border-blue-600 pb-2 mb-4">Experience</h2>

      {% for ex in cv.experience %}
      <div class="mb-4 pb-4 border-b border-gray-200">
        <div class="flex justify-between items-start mb-2">
          <div>
            <h3 class="text-lg font-bold text-gray-800">{{ ex.role or "Role" }}</h3>
            <p class="text-gray-600 font-medium">{{ ex.company or "Company" }}</p>
          </div>
          <div class="text-right text-gray-600">
            <p class="font-medium">{{ ex.start_date or "" }} - {{ ex.end_date or "Present" }}</p>
          </div>
        </div>

        {% if ex.description %}
        <ul class="list-disc ml-6 space-y-1 text-gray-700">
          {% set desc_lines = ex.description.split('
') %}
          {% for line in desc_lines %}
            {% set cleaned = line.strip() %}
            {% if cleaned %}
              {# Remove numbered prefixes like "1.", "2.", etc. #}
              {% if cleaned[0:2]|int(0) > 0 and cleaned[2:3] in ['.', ')', '-'] %}
                {% set cleaned = cleaned[2:].lstrip('.)- ').strip() %}
              {% endif %}
              <li>{{ cleaned }}</li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}
      </div>
      {% endfor %}
    </section>
    {% endif %}

    <!-- PROJECTS -->
    {% if cv.projects %}
    <section class="mb-6">
      <h2 class="text-2xl font-bold text-blue-600 uppercase tracking-wide border-b-2 border-blue-600 pb-2 mb-4">Projects</h2>

      {% for p in cv.projects %}
      <div class="mb-4">
        <div class="flex justify-between items-start mb-2">
          <h3 class="text-lg font-bold text-gray-800">{{ p.project_name or p.title or "Project" }}</h3>
          {% if p.date %}<span class="text-gray-600">{{ p.date }}</span>{% endif %}
        </div>

        {% if p.description %}
        <ul class="list-disc ml-6 space-y-1 text-gray-700">
          {% for line in p.description.split('
') %}
            {% if line.strip() %}
            <li>{{ line.strip() }}</li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}

        {% if p.technologies %}
        <p class="text-sm text-gray-600 mt-2"><strong>Technologies:</strong> {{ p.technologies }}</p>
        {% endif %}
      </div>
      {% endfor %}
    </section>
    {% endif %}

    <!-- EDUCATION -->
    {% if cv.education %}
    <section class="mb-6">
      <h2 class="text-2xl font-bold text-blue-600 uppercase tracking-wide border-b-2 border-blue-600 pb-2 mb-4">Education</h2>

      {% for ed in cv.education %}
      <div class="mb-3">
        <p class="text-lg font-bold text-gray-800">{{ ed.degree or "Degree" }}</p>
        <p class="text-gray-600">{{ ed.institute or "Institution" }}</p>
        <p class="text-gray-500 text-sm">{{ ed.start_year }} - {{ ed.end_year }}</p>
      </div>
      {% endfor %}
    </section>
    {% endif %}

    <!-- SKILLS -->
    {% if cv.skills %}
    <section class="mb-6">
      <h2 class="text-2xl font-bold text-blue-600 uppercase tracking-wide border-b-2 border-blue-600 pb-2 mb-4">Skills</h2>
      {% if cv.skills is mapping %}
        {# Categorized skills as dict #}
        {% for category, skills_list in cv.skills.items() %}
          {% if category != 'General' or (category == 'General' and skills_list and skills_list|length > 0) %}
          <div class="mb-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ category }}</h3>
            <div class="flex flex-wrap gap-3 text-gray-700">
              {% if skills_list is string %}
                <span class="border-l-4 border-blue-600 pl-3 py-1">{{ skills_list }}</span>
              {% elif skills_list is iterable and skills_list is not string %}
                {% for skill in skills_list %}
                  {% if skill %}
                  <span class="border-l-4 border-blue-600 pl-3 py-1">{{ skill }}</span>
                  {% endif %}
                {% endfor %}
              {% endif %}
            </div>
          </div>
          {% endif %}
        {% endfor %}
      {% elif cv.skills is iterable and cv.skills is not string %}
        {# List of skills #}
        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-gray-700">
          {% for skill in cv.skills %}
            {% if skill is string %}
            <div class="border-l-4 border-blue-600 pl-3 py-1">{{ skill }}</div>
            {% endif %}
          {% endfor %}
        </div>
      {% else %}
        {# String format #}
        <p class="text-gray-700">{{ cv.skills }}</p>
      {% endif %}
    </section>
    {% endif %}

    <!-- CERTIFICATIONS -->
    {% if cv.certifications %}
    <section class="mb-6">
      <h2 class="text-2xl font-bold text-blue-600 uppercase tracking-wide border-b-2 border-blue-600 pb-2 mb-4">Certifications</h2>

      {% for cert in cv.certifications %}
      <p class="text-gray-700">â€¢ <strong>{{ cert.name }}</strong> - {{ cert.issuer }} ({{ cert.year }})</p>
      {% endfor %}
    </section>
    {% endif %}

  </div>
</body>
</html>
